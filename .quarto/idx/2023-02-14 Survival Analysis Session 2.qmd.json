{"title":"2023-02-14 Session 2","markdown":{"yaml":{"title":"2023-02-14 Session 2","format":{"html":{"self-contained":true,"code-line-numbers":true}},"custom_title_page":false,"filters":["lightbox"],"lightbox":"auto"},"headingText":"abstract: The objective of the exercise is to practice Cox-regression. It starts doing a survival curve (K-M) for all the sample, then by group of treatment. Finally we need to create the Cox-regression model using the classical approach to select the variables that will be part of the model.","containsRefs":false,"markdown":"\n---\nsubtitle: \"Survival Analysis - Session 2\"\ndate: 2023-02-14\n\nauthor:\n  - name: Javier Silva-Valencia\n    orcid: 0000-0002-5982-2821\n    email: javier.silva@unmsm.edu.pe\n    affiliations:\n      - name: Instituut Voor Tropische Geneeskunde. Antwerp-Belgium\n\nlanguage: \n  title-block-author-single: \"Writer\"\n  \n\n---\n\n---\n\n\n### Starting the Exercise\n\nIndications: \n\nThe data in ExerciseII.xls are results of an (hypothetical) observational cancer trial. The aim of the study was to compare two treatment strategies for a brain tumour: one of consists of local radiation (control regimen), one of a combination of local radiation and aggressive chemotherapy (test regimen). The endpoint of the study was survival duration after therapy.\n\nUse R to explore the data. Describe the patient demographics and survival using Kaplan-Meier curves. Do you think that the test regimen prolongs survival? Analyze the data further using Cox-regression. Describe your conclusions.\n\n::: {.callout-tip collapse=\"true\"}\n## Important initial information \n\nAnalysis variable: Time to death \n\nInitial time: When the treatment begins \n\nEnd time: time of dead \n\nIndependent variable: Type of treatment (local radiation vs local+chemotherapy)\n:::\n\n#### Step 1\nFirst we import the data from an excel file\n\n```{r}\nlibrary(readxl)\nExerciseII <- read_excel(\"C:/Users/pined/OneDrive - Universidad Nacional Mayor de San Marcos/Javier 2022/Belgica/AC2/Survival Analysis Exercise Database/Exercises/ExerciseII.xls\")\n```\n\nTo start working with survival analysis we need an event variable (1 when the event happened, otherwise 0) \n\nIn this case we already have the \"died\" variable\n\n#### Step 2\nDoing the Kaplan-Meyer curve (survival curve) for all the sample\n\n```{r}\n#| echo: fenced\n#Code for K-M curve\nlibrary(survival)\nmod0 <- survfit(Surv(time, died) ~ 1, data=ExerciseII)\n```\n\n```{r}\n#Code for Kaplan-Meyer Graph\nplot(mod0, mark.time=TRUE)\n```\n\n#### Step 3\nKaplan-Meyer curve (survival curve) by group of treatment\n\n```{r}\n#| echo: fenced\n#Code for K-M curve\nmod1 <- survfit(Surv(time, died) ~ trt, data=ExerciseII)\n\n#Code for Kaplan-Meyer Graph\nplot(mod1, mark.time=TRUE, lty=1:2)\nlegend (\"top\", legend=unique(ExerciseII$trt), lty=1:2)\n```\nWe can also see the numbers of the graphic\n\n```{r}\nmod1\n```\n\n::: callout-tip\n## Interpretation\nIn Treatment 0 (local radiation): 50% of the population was alive at day 512 \n\nIn Treatment 1 (local + chemoteraphy): 50% of the population was alive at day 434\n\nSo, at first glance, it seems that in treatment 1, people tend to die faster. Is this true?? *We cannot say yet, we need to do the multivariate analysis with other variables that may be intervening*\n:::\n\n#### Step 4\nCreating Cox Regression model (using the classical model)\n\n4.1 Creating Cox regression with each of the (possible) predictors separately (bivariate analysis):\n\n::: callout-tip\nThe Possible predictors could be: gender, trt and type\n\nAll those could be predictors or counfounders because this is not a clinical trial. (In a clinical trial the amount of persons in each group is fixed)\n::: \n\n```{r}\n#| echo: fenced\n#Creating the Cox models for each variable (bivariate)\nlibrary(survival)\nCox1<- coxph(Surv(time, died) ~ trt, data=ExerciseII)\nCox2<- coxph(Surv(time, died) ~ gender, data=ExerciseII)\nCox3<- coxph(Surv(time, died) ~ type, data=ExerciseII)\n\nsummary(Cox1)\nsummary(Cox2)\nsummary(Cox3)\n\n```\n\n::: callout-tip\n## Results from above\n\n| Factor |  HR   |    95% IC    | p-value |\n|:------:|:-----:|:------------:|:-------:|\n|  trt   | 1.264 | 1.028 1.554  | 0.0264  |\n| gender | 1.034 | 0.8446 1.266 |  0.747  |\n|  type  | 3.519 |  2.83 4.376  | < 2e-16 |\n\nNow we have to select those with p < 0.200 (or 0.100 depending on our analysis plan) for further modeling\n\nThis means that all variables with  p < 0.200 (type) are potential factors that could be in our final model.\n\nWe also keep \"trt\" because it is the main independent variable\n\n:::\n\n4.2 Entering the selected variables in a multivariable model and then removing the non-significant factors one by one (always removing the least significant factor). \"Backwards elimination\"\n\n```{r}\n#| echo: fenced\n#Creating the Cox model for all selected variables (multivariate)\nlibrary(survival)\nCox4<- coxph(Surv(time, died) ~ trt + type , data=ExerciseII)\nsummary(Cox4)\n```\n\n::: callout-tip\n## Reply\nBoth independant variable (trt and type) are significant (p value = 2.06e-06 and < 2e-16 )\n\nSo we need to keep both independent variables. But, are they ok like that, or there is an interaction?\n:::\n\n\n4.3 Checking for interaction\n\n```{r}\n#| echo: fenced\n#Creating the Cox model for all selected variables considering interaction\nCox5<- coxph(Surv(time, died) ~ trt * type , data=ExerciseII)\nsummary(Cox5)\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Things to keep in mind\nIt seems that with the treatment effect interaction it is no longer significant (HR: 0.8987, pvalue= 0.6260), but it is not true.\n\nBecause we're introducing the interaction, when we see the HR = 0.8987 it's the HR for the local cancer only.\n::: \n\n\n::: callout-tip\n## Reply\n\nThe data from the model is:\n\n| Factor |  HR   |\n|:------:|:-----:|\n|  trt   | 0.8987 |\n| type   | 5.8185 |\n|  trt:type  | 0.5270 |\n\nBut to know the correct HR of trt we have to add the HR of the interaction:   \n\n.            HR of trt = 0.899^trt * 0.5270^(trt*type)\n\nHR trt in local cancer = 0.899^trt * 0.5270^(trt*0) \nHR trt in local cancer = 0.899^trt * 1 \nHR trt in local cancer = 0.899\n\nHR trt for metastatic cancer = 0.899^trt * 0.5270^(trt*type)\nHR trt for metastatic cancer = 0.899^trt * 0.5270^(trt*1)\nHR trt for metastatic cancer = 0.899     * 0.527\nHR trt for metastatic cancer = 0.473\n\n\n:::\n\n4.4 We need to compare both models to check if the model with interaction is significantly better\n\n```{r}\nanova(Cox5, Cox4, test=\"Chisq\")\n```\n\n::: callout-tip\n## Reply\nThere is a significant difference with and without interaction models (p = 0.01725). So we keep the interaction.\n:::\n\n4.5 To present better the data with interaction is better to divide the dataset according each group of interaction and to present the model separately.\n\nCreating subsets according each group of interaction:\n\n```{r}\n#| echo: fenced\ntable(ExerciseII$type)\nLocalCancer  <-  subset(ExerciseII, type==0)  #Creating a database for local cancer\nMetastatic  <-  subset(ExerciseII, type==1)    #Creating a database for metastatic\n```\n\nChecking the kaplan-meyer curve and cox regressión in each subset\n\n4.5.1 IN LOCAL CANCER\n\n```{r}\n#| echo: fenced\n#Kaplan-Meyer curve\nmodLC <- survfit(Surv(time, died) ~ trt, data=LocalCancer)\nplot(modLC, mark.time=TRUE, lty=1:2)\nlegend (\"top\", legend=unique(LocalCancer$trt), lty=1:2)\n```\n```{r}\n#| echo: fenced\n#Cox Regression\nCoxLC<- coxph(Surv(time, died) ~ trt, data=LocalCancer)\nsummary(CoxLC)\n```\n::: callout-tip\n## Interpretation:\n\nHR local cancer = 0.90    IC95%(0.5877     1.387)\n\nAmong those with local cancer, the ones that undergo the new treatment has 10% less hazard of die than the ones that went with the traditional treatment.But this is not significant.\n\nThat is the same to say:\n\nAmong those with local cancer, getting the new treatment reduces your hazard of dying by 10%. But this is not significant.\n\n::: \n\n\n4.4.2 IN METASTATIC CANCER\n\n```{r}\n#| echo: fenced\n#Kaplan-Meyer curve\nmodMC <- survfit(Surv(time, died) ~ trt, data=Metastatic)\nplot(modMC, mark.time=TRUE, lty=1:2)\nlegend (\"top\", legend=unique(Metastatic$trt), lty=1:2)\n```\n\n```{r}\n#| echo: fenced\n#Cox regressión\nCoxMC<- coxph(Surv(time, died) ~ trt, data=Metastatic)\nsummary(CoxMC)\n```\n::: callout-tip\n## Interpretation:\n\nHR metastatic cancer = 0.46  IC95% (0.3504    0.6137)\n\nAmong those with metastasis cancer, the ones that undergo the new treatment has 54% less hazard of die than the ones that went with the traditional treatment.\n\nThat is the same to say:\n\nAmong those with metastasis cancer, getting the new treatment reduces your hazard of dying by 54%\n\nHR local cancer = 0.90 \n::: "},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":true,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":4,"reference-location":"margin","filters":["lightbox"],"self-contained":true,"output-file":"2023-02-14 Survival Analysis Session 2.html"},"language":{"title-block-author-single":"Writer"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","knitr":{"opts_chunk":{"cache":true,"cache.lazy":false,"R.options":{"knitr.graphics.auto_pdf":true},"attr.source":".numberLines"}},"theme":{"light":"flatly"},"fontsize":"16px","linestretch":1.6,"smooth-scroll":true,"title":"2023-02-14 Session 2","custom_title_page":false,"lightbox":"auto","subtitle":"Survival Analysis - Session 2","date":"2023-02-14","author":[{"name":"Javier Silva-Valencia","orcid":"0000-0002-5982-2821","email":"javier.silva@unmsm.edu.pe","affiliations":[{"name":"Instituut Voor Tropische Geneeskunde. Antwerp-Belgium"}]}],"abstract":"The objective of the exercise is to practice Cox-regression. It starts doing a survival curve (K-M) for all the sample, then by group of treatment. Finally we need to create the Cox-regression model using the classical approach to select the variables that will be part of the model."},"extensions":{"book":{"multiFile":true}}}}}