{"title":"2023-02-14 Session 2","markdown":{"yaml":{"title":"2023-02-14 Session 2","format":{"html":{"self-contained":true}},"editor_options":{"chunk_output_type":"inline"}},"headingText":"Step by Step","containsRefs":false,"markdown":"\n\n-   Instituut Voor Tropische Geneeskunde - Antwerp, Belgium\n\n\n### Starting the Exercise\n\nThe data in ExerciseII.xls are results of an (hypothetical) observational cancer trial. The aim of the study was to compare two treatment strategies for a brain tumour: one of consists of local radiation (control regimen), one of a combination of local radiation and aggressive chemotherapy (test regimen). The endpoint of the study was survival duration after therapy.\n\nUse R to explore the data. Describe the patient demographics and survival using Kaplan-Meier curves. Do you think that the test regimen prolongs survival? Analyze the data further using Cox-regression. Describe your conclusions.\n\n::: callout-note\nImportant information: Analysis variable: Time to death Initial time: When the treatment begins End time: time of dead Independent variable: Type of treatment (local radiation vs local+chemotherapy)\n:::\n\n#### 1. First we import the data from an excel file\n\n```{r}\nlibrary(readxl)\nExerciseII <- read_excel(\"C:/Users/pined/OneDrive - Universidad Nacional Mayor de San Marcos/Javier 2022/Belgica/AC2/Survival Analysis Exercise Database/Exercises/ExerciseII.xls\")\n```\n\nTo start working with survival analysis we need an event variable (1 is the event happened, otherwise 0) In this case we have the \"died\" variable\n\n#### 2. Kaplan-Meyer curve (survival curve) for all the sample\n\n```{r}\n#| echo: fenced\nlibrary(survival)\nmod0 <- survfit(Surv(time, died) ~ 1, data=ExerciseII)\n```\n\n```{r}\n#Kaplan-Meyer Graph\nplot(mod0, mark.time=TRUE)\n```\n![ ](SurvAnalysisSesion2Graph/fig1.jpg)\n\n#### 3. Kaplan-Meyer curve (survival curve) by group of treatment\n\n```{r}\n#| echo: fenced\nmod1 <- survfit(Surv(time, died) ~ trt, data=ExerciseII)\nplot(mod1, mark.time=TRUE, lty=1:2)\nlegend (\"top\", legend=unique(ExerciseII$trt), lty=1:2)\n```\n![ ](SurvAnalysisSesion2Graph/fig2.jpg)\n\nTo see the numbers\n\n```{r}\nmod1\n```\n\n::: callout-note\nTreatment 0 = Control = local radiation = 50% of the population was alive at day 512 Treatment 1 = Intervention = local + chemoteraphy = 50% of the population was alive at day 434\n\nSeems that in treatment 1, people tends to die more quickly\n:::\n\n#### 4. Creating Cox Regresion model (using the classical model)\n\n4.1 Creating Cox regresion with each of the (possible) predictors separately:\n\nPossible predictors: gender, trt an type (could be predictors/counfounders because this is not a clinical trial. In a clinical trial the amount of persons in each group is fixed)\n\n```{r}\n#| echo: fenced\nlibrary(survival)\nCox1<- coxph(Surv(time, died) ~ trt, data=ExerciseII)\nCox2<- coxph(Surv(time, died) ~ gender, data=ExerciseII)\nCox3<- coxph(Surv(time, died) ~ type, data=ExerciseII)\n\nsummary(Cox1)\nsummary(Cox2)\nsummary(Cox3)\n\n```\n\n::: callout-note\n| Factor |  HR   |    95% IC    | p-value |\n|:------:|:-----:|:------------:|:-------:|\n|  trt   | 1.264 | 1.028 1.554  | 0.0264  |\n| gender | 1.034 | 0.8446 1.266 |  0.747  |\n|  type  | 3.519 |  2.83 4.376  | \\<2e-16 |\n\nNow we select those with p \\<0.200 (or 0.100 depending on analysis plan) for further modeling\n:::\n\n4.2 Entering the remaining variables in a multivariable models and remove step-by-step the non-significant terms (always removing the least significant factor). \"Backwards elimination\"\n\n```{r}\n#| echo: fenced\nlibrary(survival)\nCox4<- coxph(Surv(time, died) ~ trt + type , data=ExerciseII)\nsummary(Cox4)\n```\n\n::: callout-note\nBoth are significant, so we need to keep both independent variables But, are they ok like that, or there is an interaction?\n:::\n\n4.3 Checking for interaction\n\n```{r}\n#| echo: fenced\nCox5<- coxph(Surv(time, died) ~ trt * type , data=ExerciseII)\nsummary(Cox5)\n```\n\n::: callout-note\nThings to note: Seems that the interaction the treatment effect in the whole sample is no longer significant (HR: 0.8987, pvalue= 0.6260), but it is not true. Because of we are introducing interaction that HR= 0.8987 is the HR only for the local cancer.\n\n                         HR = 0.899^trt * 5.8185^type * 0.5270^(trt*type)\n                         \n    HR trt for local cancer = 0.899^trt               * 0.5270^(trt*0) \n    HR trt for local cancer = 0.899                   * 1 \n    HR trt for local cancer = 0.899\n\n    HR trt for metastatic cancer = 0.899 * 5.8185^1 * 0.5270^(trt*type)\n\n    HR trt for metastatic cancer = 0.899 * 0.527 = 0.473\n\nAlso looking only at interaction p-value (0.0132): seems significant\n:::\n\nWe need to compare both models\n\n```{r}\nanova(Cox5, Cox4, test=\"Chisq\")\n```\n\n::: callout-note\nThere is a significant difference with and without interaction models So we keep with the interaction.\n:::\n\n4.4 Checking HR for each group of interaction\n\n```{r}\ntable(ExerciseII$type)\nLocalCancer  <-  subset(ExerciseII, type==0)  #Creating a database for local cancer\nMetastatic  <-  subset(ExerciseII, type==1)    #Creating a database for metastatic\n```\n\nChecking the kaplan meyer curve and cox regressión in each subset\n\n4.4.1 IN LOCAL CANCER\n\n```{r}\n#| echo: fenced\nmodLC <- survfit(Surv(time, died) ~ trt, data=LocalCancer)\nplot(modLC, mark.time=TRUE, lty=1:2)\nlegend (\"top\", legend=unique(LocalCancer$trt), lty=1:2)\n```\n![ ](SurvAnalysisSesion2Graph/fig3_localcanc.jpg)\n\n\n```{r}\n#| echo: fenced\nCoxLC<- coxph(Surv(time, died) ~ trt, data=LocalCancer)\nsummary(CoxLC)\n```\n\n4.4.2 IN METASTATIC CANCER\n\n```{r}\n#| echo: fenced\n#Kaplay-Meyer curve\nmodMC <- survfit(Surv(time, died) ~ trt, data=Metastatic)\nplot(modMC, mark.time=TRUE, lty=1:2)\nlegend (\"top\", legend=unique(Metastatic$trt), lty=1:2)\n```\n![ ](SurvAnalysisSesion2Graph/fig4_metastasic.jpg)\n\n```{r}\n#| echo: fenced\n#Cox regressión\nCoxMC<- coxph(Surv(time, died) ~ trt, data=Metastatic)\nsummary(CoxMC)\n```\n\nAmong those with mett cancer,The ones that undergo the new treatment has 54% less hazard of die than the one that went with the traditional treatment.\n\nAmong those with mett cancer, getting the new treatment reduces your hazars of dying by 54%\n\nHR local cancer = 0.90 HR metastatic cancer = 0.46\n\nInteraction term = 0.46/0.90 = 0.51\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"self-contained":true,"output-file":"2023-02-14 Survival Analysis Session 2.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","theme":{"light":"flatly"},"title":"2023-02-14 Session 2","editor_options":{"chunk_output_type":"inline"}},"extensions":{"book":{"multiFile":true}}}}}