{"title":"2023-02-09 Assigment","markdown":{"yaml":{"title":"2023-02-09 Assigment","format":{"html":{"self-contained":true}}},"headingText":"Step by Step - Selection of variables for modeling","containsRefs":false,"markdown":"\n\n-   Instituut Voor Tropische Geneeskunde - Antwerp, Belgium\n\n\n##### Import data\n\nImporting a CSV database under the name of \"VL_Bihar\":\n\n```{r}\nlibrary(readxl)\nVL_Bihar <- read_excel(\"C:/Users/pined/OneDrive - Universidad Nacional Mayor de San Marcos/Javier 2022/Belgica/AC2/Logistic Regresion Exercise Database/Datasets/VL_Bihar.xlsx\")\n```\n\n### Starting the Exercise:\n\n##### 1. Description of the study population\n\n1.1 Sex\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$sex, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$sex))           #proportion\n```\n\n1.2 Age\n\n```{r}\n#| echo: fenced\nsummary(VL_Bihar$age)\n```\n\n1.2.1 Categories of age\n\n```{r}\n#| echo: fenced\n#Group Age\nVL_Bihar$groupage <- NA\nVL_Bihar$groupage[VL_Bihar$age<15] <- \"0\"\nVL_Bihar$groupage[VL_Bihar$age>14 & VL_Bihar$age<35] <- \"1\"\nVL_Bihar$groupage[VL_Bihar$age>34] <- \"2\"\n\ntable(VL_Bihar$groupage, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$groupage, useNA = \"always\"))           #proportion\n\n```\n\n1.3 Case\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$case, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$case))           #proportion\n```\n\n1.4. Died\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$died, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$died))           #proportion\n```\n\n1.5. neem_tree\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$neem_tree, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$neem_tree))           #proportion\n```\n\n1.6. bamboo_tree\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$bamboo_tree, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$bamboo_tree))           #proportion\n```\n\n1.7. banana_tree\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$banana_tree, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$banana_tree))           #proportion\n```\n\n1.8. rice_field\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$rice_field, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$rice_field))           #proportion\n```\n\n1.9. permanent_water_body\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$permanent_water_body, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$permanent_water_body))           #proportion\n```\n\n1.10 granaries_in_hh\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$granaries_in_hh, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$granaries_in_hh))           #proportion\n```\n\n1.11 owngoat\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$owngoat, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$owngoat))           #proportion\n```\n\n1.12 ownpoul\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$ownpoul, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$ownpoul))           #proportion\n```\n\n1.13 ownbov\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$ownbov, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$ownbov))           #proportion\n```\n\n1.14 bednet\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$bednet, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$bednet))           #proportion\n```\n\n1.15 asset_index\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$asset_index, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$asset_index))           #proportion\n```\n\n1.16 riskwall\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$riskwall, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$riskwall))           #proportion\n```\n\n1.17 earthfloor\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$earthfloor, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$earthfloor))           #proportion\n```\n\n1.18 sc_caste\n\n```{r}\n#| echo: fenced\ntable(VL_Bihar$sc_caste, useNA = \"always\")     #frecuency\nprop.table(table(VL_Bihar$sc_caste))           #proportion\n```\n\n##### 2. Bivariate analysis\n\n2.1 Case and sex\n\n```{r}\n#| echo: fenced\n    GLM1 <- glm(formula = case ~ factor(sex), family = binomial, data = VL_Bihar)\n    summary(GLM1)\n    exp(coef(GLM1))\n    exp(confint(GLM1))\n```\n\n2.2 Case and age\n\n```{r}\n#| echo: fenced\n    GLM2 <- glm(formula = case ~ age, family = binomial, data = VL_Bihar)\n    summary(GLM2)\n    exp(coef(GLM2))\n    exp(confint(GLM2))\n```\n\n2.2.1 Case and age group\n\n```{r}\n#| echo: fenced\n    GLM2_1 <- glm(formula = case ~ groupage, family = binomial, data = VL_Bihar)\n    summary(GLM2_1)\n    exp(coef(GLM2_1))\n    exp(confint(GLM2_1))\n```\n\n2.3 Case and died\n\n```{r}\n#| echo: fenced\n    GLM3 <- glm(formula = case ~ factor(died), family = binomial, data = VL_Bihar)\n    summary(GLM3)\n    exp(coef(GLM3))\n    exp(confint(GLM3))\n```\n\n2.4 Case and neem_tree\n\n```{r}\n#| echo: fenced\n    GLM4 <- glm(formula = case ~ factor(neem_tree), family = binomial, data = VL_Bihar)\n    summary(GLM4)\n    exp(coef(GLM4))\n    exp(confint(GLM4))\n```\n\n2.5 Case and bamboo_tree\n\n```{r}\n#| echo: fenced\n    GLM5 <- glm(formula = case ~ factor(bamboo_tree), family = binomial, data = VL_Bihar)\n    summary(GLM5)\n    exp(coef(GLM5))\n    exp(confint(GLM5))\n```\n\n2.6 Case and banana_tree\n\n```{r}\n#| echo: fenced\n    GLM6 <- glm(formula = case ~ factor(banana_tree), family = binomial, data = VL_Bihar)\n    summary(GLM6)\n    exp(coef(GLM6))\n    exp(confint(GLM6))\n```\n\n2.7 Case and rice_field\n\n```{r}\n#| echo: fenced\n    GLM7 <- glm(formula = case ~ factor(rice_field), family = binomial, data = VL_Bihar)\n    summary(GLM7)\n    exp(coef(GLM7))\n    exp(confint(GLM7))\n```\n\n2.8 Case and permanent_water_body\n\n```{r}\n#| echo: fenced\n    GLM8 <- glm(formula = case ~ factor(permanent_water_body), family = binomial, data = VL_Bihar)\n    summary(GLM8)\n    exp(coef(GLM8))\n    exp(confint(GLM8))\n```\n\n2.9 Case and granaries_in_hh\n\n```{r}\n#| echo: fenced\n    GLM9 <- glm(formula = case ~ factor(granaries_in_hh), family = binomial, data = VL_Bihar)\n    summary(GLM9)\n    exp(coef(GLM9))\n    exp(confint(GLM9))\n```\n\n2.10 Case and owngoat\n\n```{r}\n#| echo: fenced\n    GLM10 <- glm(formula = case ~ factor(owngoat), family = binomial, data = VL_Bihar)\n    summary(GLM10)\n    exp(coef(GLM10))\n    exp(confint(GLM10))\n```\n\n2.11 Case and ownpoul\n\n```{r}\n#| echo: fenced\n    GLM11 <- glm(formula = case ~ factor(ownpoul), family = binomial, data = VL_Bihar)\n    summary(GLM11)\n    exp(coef(GLM11))\n    exp(confint(GLM11))\n```\n\n2.12 Case and ownbov\n\n```{r}\n#| echo: fenced\n    GLM12 <- glm(formula = case ~ factor(ownbov), family = binomial, data = VL_Bihar)\n    summary(GLM12)\n    exp(coef(GLM12))\n    exp(confint(GLM12))\n```\n\n2.13 Case and bednet\n\n```{r}\n#| echo: fenced\n    GLM13 <- glm(formula = case ~ factor(bednet), family = binomial, data = VL_Bihar)\n    summary(GLM13)\n    exp(coef(GLM13))\n    exp(confint(GLM13))\n```\n\n2.14 Case and asset_index\n\n```{r}\n#| echo: fenced\n    GLM14 <- glm(formula = case ~ factor(asset_index), family = binomial, data = VL_Bihar)\n    summary(GLM14)\n    exp(coef(GLM14))\n    exp(confint(GLM14))\n```\n\n2.15 Case and riskwall\n\n```{r}\n#| echo: fenced\n    GLM15 <- glm(formula = case ~ factor(riskwall), family = binomial, data = VL_Bihar)\n    summary(GLM15)\n    exp(coef(GLM15))\n    exp(confint(GLM15))\n```\n\n2.16 Case and earthfloor\n\n```{r}\n#| echo: fenced\n    GLM16 <- glm(formula = case ~ factor(earthfloor), family = binomial, data = VL_Bihar)\n    summary(GLM16)\n    exp(coef(GLM16))\n    exp(confint(GLM16))\n```\n\n2.17 Case and sc_caste\n\n```{r}\n#| echo: fenced\n    GLM17 <- glm(formula = case ~ factor(sc_caste), family = binomial, data = VL_Bihar)\n    summary(GLM17)\n    exp(coef(GLM17))\n    exp(confint(GLM17))\n```\n\n##### 3. Multivariate analysis. Association between incidence of visceral leshmanis and regular use of bednet and which factors are potential confounders\n\nWe will do the \"Change in Estimate Model\"\n\nStep 1. We select the factor that can be the main exposure and the other exposures that have logic\n\n::: callout-note\nMain exposure: regular use of bed net\n\nExclude: Died\n:::\n\nStep 2. First do the crude odd ratio (bivariate)\n\n## Output\n\n```{r}\n#| echo: fenced\nML1 <- glm(factor(case) ~ factor(bednet), family=binomial, data=VL_Bihar)\nsummary(ML1)\nexp(coef(ML1))\nexp(confint(ML1))\n```\n\nStep 3. Then adding each other variable and writing it down. And doing the table of how much change the OR\n\nCase \\~ bednet + sex\n\n```{r}\n#| echo: fenced\nML2 <- glm(factor(case) ~ factor(bednet) + factor(sex), family=binomial, data=VL_Bihar)\nexp(coef(ML2))\nexp(confint(ML2))\n```\n\nCase \\~ bednet + age\n\n```{r}\n#| echo: fenced\nML3 <- glm(factor(case) ~ factor(bednet) + age, family=binomial, data=VL_Bihar)\nexp(coef(ML3))\nexp(confint(ML3))\n```\n\nCase \\~ bednet + groupage\n\n```{r}\n#| echo: fenced\nML3_2 <- glm(factor(case) ~ factor(bednet) + groupage, family=binomial, data=VL_Bihar)\nexp(coef(ML3_2))\nexp(confint(ML3_2))\n```\n\nCase \\~ bednet + neem_tree\n\n```{r}\n#| echo: fenced\nML4 <- glm(factor(case) ~ factor(bednet) + factor(neem_tree), family=binomial, data=VL_Bihar)\nexp(coef(ML4))\nexp(confint(ML4))\n```\n\nCase \\~ bednet + bamboo_tree\n\n```{r}\n#| echo: fenced\nML5 <- glm(factor(case) ~ factor(bednet) + factor(bamboo_tree), family=binomial, data=VL_Bihar)\nexp(coef(ML5))\nexp(confint(ML5))\n```\n\nCase \\~ bednet + banana_tree\n\n```{r}\n#| echo: fenced\nML6 <- glm(factor(case) ~ factor(bednet) + factor(banana_tree), family=binomial, data=VL_Bihar)\nexp(coef(ML6))\nexp(confint(ML6))\n```\n\nCase \\~ bednet + rice_field\n\n```{r}\n#| echo: fenced\nML7 <- glm(factor(case) ~ factor(bednet) + factor(rice_field), family=binomial, data=VL_Bihar)\nexp(coef(ML7))\nexp(confint(ML7))\n```\n\nCase \\~ bednet + permanent_water_body\n\n```{r}\n#| echo: fenced\nML8 <- glm(factor(case) ~ factor(bednet) + factor(permanent_water_body), family=binomial, data=VL_Bihar)\nexp(coef(ML8))\nexp(confint(ML8))\n```\n\nCase \\~ bednet + granaries_in_hh\n\n```{r}\n#| echo: fenced\nML9 <- glm(factor(case) ~ factor(bednet) + factor(granaries_in_hh), family=binomial, data=VL_Bihar)\nexp(coef(ML9))\nexp(confint(ML9))\n```\n\nCase \\~ bednet + owngoat\n\n```{r}\n#| echo: fenced\nML10 <- glm(factor(case) ~ factor(bednet) + factor(owngoat), family=binomial, data=VL_Bihar)\nexp(coef(ML10))\nexp(confint(ML10))\n```\n\nCase \\~ bednet + ownpoul\n\n```{r}\n#| echo: fenced\nML11 <- glm(factor(case) ~ factor(bednet) + factor(ownpoul), family=binomial, data=VL_Bihar)\nexp(coef(ML11))\nexp(confint(ML11))\n```\n\nCase \\~ bednet + ownbov\n\n```{r}\n#| echo: fenced\nML12 <- glm(factor(case) ~ factor(bednet) + factor(ownbov), family=binomial, data=VL_Bihar)\nexp(coef(ML12))\nexp(confint(ML12))\n```\n\nCase \\~ bednet + asset_index\n\n```{r}\n#| echo: fenced\nML13 <- glm(factor(case) ~ factor(bednet) + factor(asset_index), family=binomial, data=VL_Bihar)\nsummary(ML13)\nexp(coef(ML13))\nexp(confint(ML13))\n```\n\nCase \\~ bednet + riskwall\n\n```{r}\n#| echo: fenced\nML14 <- glm(factor(case) ~ factor(bednet) + factor(riskwall), family=binomial, data=VL_Bihar)\nexp(coef(ML14))\nexp(confint(ML14))\n```\n\nCase \\~ bednet + earthfloor\n\n```{r}\n#| echo: fenced\nML15 <- glm(factor(case) ~ factor(bednet) + factor(earthfloor), family=binomial, data=VL_Bihar)\nexp(coef(ML15))\nexp(confint(ML15))\n```\n\nCase \\~ bednet + sc_caste\n\n```{r}\n#| echo: fenced\nML16 <- glm(factor(case) ~ factor(bednet) + factor(sc_caste), family=binomial, data=VL_Bihar)\nexp(coef(ML16))\nexp(confint(ML16))\n```\n\nTable of how much change the OR\n\n| Factor   | Co factor             | OR       | 95IC                  | Change-in-estimate |\n|----------|-----------------------|----------|-----------------------|--------------------|\n| Bed nets |                       | 0.4725   | 0.2941532 0.7252757   | Ref                |\n| Bed nets | factor(sex)           | 0.47374  | 0.2948994 0.7272629   | -0.3%              |\n| Bed nets | age                   | 0.496305 | 0.3083839 0.7636801   | -5.0%              |\n| Bed nets | group age             | 0.49619  | 0.3082705 0.7636340   | -5.0%              |\n| Bed nets | under5                | 0.482438 | 0.3000965 0.7413054   | -2.1%              |\n| Bed nets | factor(neem_tree), f  | 0.474045 | 0.2950723 0.7277817   | -0.3%              |\n| Bed nets | factor(bamboo_tree),  | 0.483379 | 0.30071367 0.7426603  | -2.3%              |\n| Bed nets | factor(banana_tree),  | 0.473633 | 0.2948139 0.7271530   | -0.2%              |\n| Bed nets | factor(rice_field),   | 0.480023 | 0.29863762 0.7374461  | -1.6%              |\n| Bed nets | factor(permanent_wat  | 0.472345 | 0.2939865 0.7252469   | 0.0%               |\n| Bed nets | factor(granaries_in\\_ | 0.472411 | 0.2940746 0.7252060   | 0.0%               |\n| Bed nets | factor(owngoat),      | 0.478583 | 0.2973262 0.7365004   | -1.3%              |\n| Bed nets | factor(ownpoul),      | 0.476914 | 0.2968099 0.7323453   | -0.9%              |\n| Bed nets | factor(ownbov),       | 0.467498 | 0.2906619 0.7186983   | 1.1%               |\n| Bed nets | factor(asset_index)   | 0.690651 | 0.4214821 1.0867165   | -46.2%             |\n| Bed nets | factor(riskwall), f   | 0.552839 | 0.34181591 0.8561327  | -17.0%             |\n| Bed nets | factor(earthfloor),   | 0.525292 | 0.32593161 0.80963385 | -11.2%             |\n| Bed nets | factor(sc_caste), f   | 0.547574 | 0.33945784 0.8451291  | -15.9%             |\n\n::: callout-note\nSo far we know that assess index, riskwall, earthfloor and sccastle have more than 10% of change in the OR of bednet\n\n        Assess index : change of 46.2%\n        Riskwall : change of 17%\n        earthfloor: 11.2%\n        sccastle : 15.9 ( Castle is similar to assess index, so we won´t take in to account)\n\nSo the model so far is:\n\n```{r}\nML17 <- glm(factor(case) ~ factor(bednet) + factor(asset_index) + factor(riskwall) + factor(earthfloor) , family=binomial, data=VL_Bihar)\n```\n:::\n\nStep 4: We are going to exclude factors removing one by one (starting with the one with less change: earthfloor)\n\nWe will star removing earthfloor:\n\n```{r}\n#| echo: fenced\nML18 <- glm(factor(case) ~ factor(bednet) + factor(asset_index) + factor(riskwall) , family=binomial, data=VL_Bihar)\nsummary(ML18)\nexp(coef(ML18))\nexp(confint(ML18))\n```\n\n:::\n\nAnd then comparing both models (ML17 vs ML18)\n\n```{r}\nanova(ML17, ML18, test=\"Chisq\")\n```\n\n:::\n\n::: callout-note\nBecause the Likelihood ratio test was not significant (p = 0.1157) there is not significant difference between LM17 an ML18, so we keep the simplest model ML18: factor(case) \\~ factor(bednet) + factor(asset_index) + factor(riskwall)\n:::\n\nNow we will try to remove other factor (riskwall)\n\n```{r}\n  ML19 <- glm(factor(case) ~ factor(bednet) + factor(asset_index) , family=binomial, data=VL_Bihar)\n```\n\nAnd then comparing both (ML18 vs ML19)\n\n```{r}\nanova(ML18, ML19, test=\"Chisq\")\n```\n\n:::\n\n::: callout-note\nBecause the Likelihood ratio test was not significant (p = 0.1794) there is not significant difference between LM18 an ML19, so we keep the simplest model LM19: factor(case) \\~ factor(bednet) + factor(asset_index)\n:::\n\nNow we will try to remove the other factor (assest_index)\n\n```{r}\nML20 <- glm(factor(case) ~ factor(bednet) , family=binomial, data=VL_Bihar)\n```\n\nAnd then comparing both (ML19 vs ML20)\n\n```{r}\nanova(ML19, ML20, test=\"Chisq\")\n```\n\n::: callout-note\nBecause the Likelihood ratio test was significant (1.305e-06 ) there is a significant difference between LM18 an ML19, so we keep the complex model: factor(case) \\~ factor(bednet) + factor(asset_index)\n\nSo the final model should include: Bednet and asset_index\n\nNow the question is if those factors are ok like that or there is an interaction between them?\n:::\n\nStep 5: Analyzing the interaction\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"self-contained":true,"output-file":"Personal_Assigment_ML.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","theme":{"light":"flatly"},"title":"2023-02-09 Assigment"},"extensions":{"book":{"multiFile":true}}}}}