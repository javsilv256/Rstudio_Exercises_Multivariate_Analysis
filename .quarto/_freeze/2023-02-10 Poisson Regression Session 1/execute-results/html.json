{
  "hash": "0bcc087d17326f064f0878bafb5552d3",
  "result": {
    "markdown": "---\ntitle: \"2023-02-10 Session 1\"\nformat: \n  html:\n    self-contained: true\n---\n\n\n\n-   Instituut Voor Tropische Geneeskunde - Antwerp, Belgium\n-   Javier Silva-Valencia\n\n## Step by Step - Selection of variables for modeling\n\n##### Import data\n\nImporting a CSV database under the name of \"poisson_smoking_mort\", with \",\" as separator:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npoisson_smoking_mort <- read.csv(\"C:/Users/pined/OneDrive - Universidad Nacional Mayor de San Marcos/Javier 2022/Belgica/AC2/Logistic Regresion Exercise Database/Datasets/poisson_smoking_mort.csv\", sep=\",\")\n```\n:::\n\n\n------------------------------------------------------------------------\n\n------------------------------------------------------------------------\n\n### Starting the Exercise\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(poisson_smoking_mort)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t36 obs. of  4 variables:\n $ smoke : int  2 2 2 2 2 2 2 2 2 4 ...\n $ pop   : int  145 104 98 372 846 949 824 667 537 3410 ...\n $ deaths: int  2 4 3 38 113 173 212 243 253 124 ...\n $ age   : int  1 2 3 4 5 6 7 8 9 1 ...\n```\n:::\n\n```{.r .cell-code}\npoisson_smoking_mort$smoke <-   factor(poisson_smoking_mort$smoke)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable1 <- aggregate(cbind(deaths, pop) ~ smoke, data=poisson_smoking_mort, FUN=sum)\ntable1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  smoke deaths   pop\n1     1    820  5163\n2     2   1041  4542\n3     3   4128 27691\n4     4   3141 18726\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(poisson_smoking_mort$smoke)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n1 2 3 4 \n9 9 9 9 \n```\n:::\n:::\n\n\n\n# Doing the poisson\n\n::: {.cell}\n\n```{.r .cell-code}\nGLM.1 <- glm(deaths ~  offset(log(pop)) + smoke, family=poisson(log), data=poisson_smoking_mort)\nsummary(GLM.1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = deaths ~ offset(log(pop)) + smoke, family = poisson(log), \n    data = poisson_smoking_mort)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-24.546   -5.892   -2.310    8.343   15.612  \n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.83997    0.03492 -52.689  < 2e-16 ***\nsmoke2       0.36678    0.04669   7.855 3.98e-15 ***\nsmoke3      -0.06335    0.03823  -1.657   0.0976 .  \nsmoke4       0.05460    0.03922   1.392   0.1639    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 4056.0  on 35  degrees of freedom\nResidual deviance: 3910.7  on 32  degrees of freedom\nAIC: 4158.7\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n\n```{.r .cell-code}\nexp(coef(GLM.1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept)      smoke2      smoke3      smoke4 \n  0.1588224   1.4430849   0.9386190   1.0561149 \n```\n:::\n\n```{.r .cell-code}\nexp(confint(GLM.1))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                2.5 %    97.5 %\n(Intercept) 0.1481982 0.1699422\nsmoke2      1.3170821 1.5816673\nsmoke3      0.8713912 1.0123015\nsmoke4      0.9785365 1.1411622\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nGLM.2 <- glm(deaths ~  offset(log(pop)) + smoke + factor(age), family=poisson(log), data=poisson_smoking_mort)\nsummary(GLM.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = deaths ~ offset(log(pop)) + smoke + factor(age), \n    family = poisson(log), data = poisson_smoking_mort)\n\nDeviance Residuals: \n     Min        1Q    Median        3Q       Max  \n-2.06055  -0.54773   0.06431   0.29963   1.48348  \n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  -3.68002    0.06824 -53.929  < 2e-16 ***\nsmoke2        0.04781    0.04699   1.017    0.309    \nsmoke3        0.21796    0.03869   5.633 1.77e-08 ***\nsmoke4        0.41696    0.03991  10.447  < 2e-16 ***\nfactor(age)2  0.55388    0.07999   6.924 4.38e-12 ***\nfactor(age)3  0.98039    0.07682  12.762  < 2e-16 ***\nfactor(age)4  1.37946    0.06526  21.138  < 2e-16 ***\nfactor(age)5  1.65423    0.06257  26.439  < 2e-16 ***\nfactor(age)6  1.99817    0.06279  31.824  < 2e-16 ***\nfactor(age)7  2.27141    0.06435  35.296  < 2e-16 ***\nfactor(age)8  2.55858    0.06778  37.746  < 2e-16 ***\nfactor(age)9  2.84692    0.07242  39.310  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 4055.984  on 35  degrees of freedom\nResidual deviance:   21.487  on 24  degrees of freedom\nAIC: 285.51\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\nexp(coef(GLM.2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n (Intercept)       smoke2       smoke3       smoke4 factor(age)2 factor(age)3 \n  0.02522236   1.04896769   1.24353137   1.51734120   1.73998521   2.66548728 \nfactor(age)4 factor(age)5 factor(age)6 factor(age)7 factor(age)8 factor(age)9 \n  3.97274945   5.22904532   7.37555598   9.69301740  12.91740254  17.23470015 \n```\n:::\n\n```{.r .cell-code}\nexp(confint(GLM.2))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                   2.5 %     97.5 %\n(Intercept)   0.02202415  0.0287804\nsmoke2        0.95681134  1.1503774\nsmoke3        1.15340679  1.3423453\nsmoke4        1.40394324  1.6417420\nfactor(age)2  1.48779572  2.0360399\nfactor(age)3  2.29411568  3.1006561\nfactor(age)4  3.50134746  4.5224900\nfactor(age)5  4.63399086  5.9225961\nfactor(age)6  6.53332439  8.3572514\nfactor(age)7  8.55876044 11.0155956\nfactor(age)8 11.32626342 14.7749991\nfactor(age)9 14.96968079 19.8862627\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(GLM.1, GLM.2, test=\"Chisq\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n\nModel 1: deaths ~ offset(log(pop)) + smoke\nModel 2: deaths ~ offset(log(pop)) + smoke + factor(age)\n  Resid. Df Resid. Dev Df Deviance  Pr(>Chi)    \n1        32     3910.7                          \n2        24       21.5  8   3889.2 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nGLM.3 interaction\n\nANOVA GLM.2 vs GLM.3 (interaction is not necessary)\n\n\nCheck if the dispersion parameter is near to one (if it to far to 1, then the stardat error could be wrong). This is done before we can say that this model is significant\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndispp <- sum(residuals(GLM.2, type=\"pearson\")^2)/GLM.2$df.residual\ndispp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8591398\n```\n:::\n:::\n\nMy dispersion parameter is close to 1 so we can keep it with the poisson model, but yet we will gonna try the other way (negative binomial model)\n\nlibrary(MAAS)\nGLM.NM <- glm.nb(deaths ~  offset(log(pop)) + smoke + factor(age), data=poisson_smoking_mort)\nexp(coef(GLM.NM))\nexp(confint(GLM.NM))\n\nThe OR and IC are similar in bot models (poisson and negative binomial model)\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}