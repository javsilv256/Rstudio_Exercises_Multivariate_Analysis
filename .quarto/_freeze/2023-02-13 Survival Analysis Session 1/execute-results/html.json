{
  "hash": "ae6cb8059731b04fc4b50455bb610b32",
  "result": {
    "markdown": "---\ntitle: \"2023-02-13 Session 1\"\nformat: \n  html:\n    self-contained: true\n---\n\n\n\n-   Instituut Voor Tropische Geneeskunde - Antwerp, Belgium\n-   Javier Silva-Valencia\n\n## Step by Step\n\n### Starting the Exercise\n\n###### 1. Which of the following types of data can/should be analyzed using survival analysis? What would be the analysis variable? What is the time of origin and the end point? Are the data censored, and if yes, which type of censoring occurs?\n\na) Two groups of patients with skin cancer are treated: group A gets surgical removal of the cancer, group B gets surgical removal + chemotherapy. We believe that the chemotherapy will reduce the risk of recurrence of he cancer. The patients are asked to return for a check up every 3 months for the following 5 years. At every check-up, the patients are examined for skin cancers.\n\n::: callout-note\n\n    A. Should be analyzed using survival analysis?: Yes.\n    \n        Why?, Because we are interested in the time from one event to another and also could be censoring (when we dont know when is the end point)\n        \n        Why not linear regression: Because there could be censoring in the data. There is a possibility that not all continues the follow-up or finish the study without having the event\n    \n    B. Analysis variable: Time to cancer recurrence\n    \n    C. Times\n    \n      Time of origin: Time when undergoing the intervention\n    \n      End poing: Time of the recurrence of the cancer\n    \n    D. Are the data censored?: Yes, censoring in survival analysis refers to the situation in which the exact time to event is not known for some individuals in a study.\n    \n        What type of censoring occurs?: Interval, if you are studying the recurrence of cancer, you do not know if it just appeared before the review. Also, the point where the cancer begins is not well defined.\n\n::: \n\n\nb) Two groups of patients with malaria are entered in a clinical trial: 1 group receives a new treatment, the other group receives standard care. After 3 months they are asked to return for parasitological examination. We want to see if the new treatment cures more patient than standard therapy.\n\n::: callout-note\n\n    A. Should be analyzed using survival analysis?: No, our outcome doesnt involve time. It is just one measure.\n    \n      For this we should use Logistic Regression. Because the outcome is a binary variable\n    \n    B. Analysis variable: % of patiens parasite-free at month 3\n::: \n\nc) To assess risk behaviour for HIV and other STI's, a group of adolescents (12 to 18 years) are asked when they had sexual intercourse for the first time. We are interested in estimating the age of sexual debut.\n\n::: callout-note\n\n    A. Should be analyzed using survival analysis?: Yes, our outcome is the time of sexual debut. We are interested in the time from one event to another. Also the data could be censored\n    \n    B. Analysis variable: Age of sexual debut\n    \n    C. Times\n      \n        Time of origin: Born\n    \n        End poing: Age of sexual debut\n    \n    D: Is the data censored?: Yes. There may be adolescents who have not yet had sexual relations at the time of the survey.\n    \n      This is a cross-sectional study but you ask for a time.\n \n        What type of censoring occurs? Right, by some adolescents who have not yet had sexual relations at the time of the survey\n        \n::: \n\nd) To assess risk behaviours for childhood asthma, we perform a case-control study comparing mothers of children with asthma and children without asthma. We ask the mothers when they were first pregnant. We are interested in estimating the age of first pregnancy for women with a child with asthma vs women with a child without asthma\n\n::: callout-note\n\n    A. Could be analyzed using survival analysis?: Yes (we are interested in the time from one event to another. But because we dont have censoring we can use also linear regresion)\n    \n    B. Analysis variable: Age at first pregnancy\n      \n      Independant variable: having or not a child with asthma\n    \n    C. Times\n      \n        Time of origin: Birth\n    \n        End poing: Age of first pregnancy\n    \n        \n    D. Are the data censored?: No, censoring is when we dont know the end point. In this case all women had a first pregnancy, so all have the outcome and we know when. Also, I cannot have a loss to follow-up, because it is a cross-sectional study.\n\n::: \n\n\n##### 2. We ran a clinical trial of a new less invasive surgical procedure (treatment A) for patients with myocardial infarction. This procedure is compared to the standard treatment (treatment B) which requires open-heart surgery. After surgery patients were required to return to the clinic every 3 months for a check-up. The trial was completed on 1-Jan-2006. The primary objective of the study is to compare the two treatment groups with respect to mortality, analyzed using an intention-to-treat approach. As a secondary analysis, time to cardiac event (defined as new MI or a new cardiac procedure or cardiac death) is analyzed, using a per-protocol approach. \n\n\n![Intention to treat vs Per protocol](Intention to treat.png)\n\n::: callout-note\n\nIn an intention-to-treat analysis, you analyze everyone according to the groups of the initial randomization. (Although in the end for X reasons some did not follow the planned treatment)\n\nIn a per-protocol analysis, you analyze only those who actually undergo according initial randomization.\n\n::: \n\n<sub>a. Patient 001 was randomized to treatment A. The surgery was performed on 1-Jul-2004 and was successful according to the surgeon. The patient came in for his visits and was in good health at the end of the study.</sub>\n\n::: callout-note\n\nAccording to an intention-to-treat analysis\n\n| ID \t| Original Treatment \t| Event (death) \t| Start date \t| End date \t| Reason of the end date \t| Time (start date - end date) \t|\n|----\t|--------------------\t|---------------\t|------------\t|----------\t|------------------------\t|------------------------------\t|\n| 1  \t| A                  \t| 0             \t| 1-jul-04   \t| 1-ene-06 \t| End of study           \t| 18.30                        \t|    \n\n\nAccording to an per-protocol analysis\n\n| ID \t| Treatment original \t| Real treatment \t| Cardiac Event \t| Start date \t| End date (first date of the event) \t| Reason of the end date \t| Time to event (months) \t|\n|----\t|--------------------\t|----------------\t|---------------\t|------------\t|------------------------------------\t|------------------------\t|------------------------\t|\n| 1  \t| A                  \t| A              \t| 0             \t| 1-jul-04   \t| 1-ene-06                           \t| End of study           \t| 18.30                  \t|\n\n      cardiac event (defined as new MI or a new cardiac procedure or cardiac death)\n::: \n\n<sub> b. Patient 002 was randomized to treatment A. The surgery was performed on 15-Jul-2004 and was successful according to the surgeon. On 15-Nov-2004, the patient came into the hospital with a new myocardial infarction. The patient however died 15 days later in hospital.</sub>\n\n::: callout-note\n\nAccording to an intention-to-treat analysis\n\n| ID \t| Original Treatment \t| Event (death) \t| Start date \t| End date \t| Reason of the end date \t| Time (start date - end date) \t|\n|----\t|--------------------\t|---------------\t|------------\t|----------\t|------------------------\t|------------------------------\t|\n| 2  \t| A                  \t| 1             \t| 15-jul-04  \t| 1-dic-04 \t| Died                   \t| 4.63                         \t|\n\nAccording to an per-protocol analysis\n\n| ID \t| Treatment original \t| Real treatment \t| Cardiac Event \t| Start date \t| End date (first date of the event) \t| Reason of the end date \t| Time to event (months) \t|\n|----\t|--------------------\t|----------------\t|---------------\t|------------\t|------------------------------------\t|------------------------\t|------------------------\t|\n| 2  \t| A                  \t| A              \t| 1             \t| 15-jul-04  \t| 15-nov-04                          \t| New MI                 \t| 4.10                   \t|\n\n\n::: \n\n<sub> c. Patient 003 was randomized to treatment B. The surgery was performed on 30-Jul-2004 and was successful. The patient came in hospital for the first 2 visits. The second visit was on 1-Feb-2005 when the patient was in good health. However the patient but did not return to the hospital after this date.</sub>\n\n::: callout-note\n\nAccording to an intention-to-treat analysis\n\n| ID \t| Original Treatment \t| Event (death) \t| Start date \t| End date \t| Reason of the end date \t| Time (start date - end date) \t|\n|----\t|--------------------\t|---------------\t|------------\t|----------\t|------------------------\t|------------------------------\t|\n| 3  \t| B                  \t| 0             \t| 30-jul-04  \t| 1-feb-05 \t| Lost follow up         \t| 6.20                         \t|\n\nAccording to an per-protocol analysis\n\n| ID \t| Treatment original \t| Real treatment \t| Cardiac Event \t| Start date \t| End date (first date of the event) \t| Reason of the end date \t| Time to event (months) \t|\n|----\t|--------------------\t|----------------\t|---------------\t|------------\t|------------------------------------\t|------------------------\t|------------------------\t|\n| 3  \t| B                  \t| B              \t| 0             \t| 30-jul-04  \t| 1-feb-05                           \t| Lost follow up         \t| 6.20                   \t|\n\n::: \n\n<sub> d. Patient 004 was randomized to standard treatment. When in the operating room (on 1-Aug-2004), the surgeon however decided that the standard surgery was too dangerous to perform, due to the bad condition of the patient. Instead, the new less invasive operation was performed. The patient died in hospital 15 days after the operation.</sub>\n\n::: callout-note\n\nAccording to an intention-to-treat analysis\n\n| ID \t| Original Treatment \t| Event (death) \t| Start date \t| End date  \t| Reason of the end date \t| Time (start date - end date) \t|\n|----\t|--------------------\t|---------------\t|------------\t|-----------\t|------------------------\t|------------------------------\t|\n| 4  \t| B                  \t| 1             \t| 1-ago-04   \t| 16-ago-04 \t| Died                   \t| 0.50                         \t|\n\nAccording to an per-protocol analysis\n\n| ID \t| Treatment original \t| Real treatment \t| Cardiac Event \t| Start date \t| End date (first date of the event) \t| Reason of the end date \t| Time to event (months) \t|\n|----\t|--------------------\t|----------------\t|---------------\t|------------\t|------------------------------------\t|------------------------\t|------------------------\t|\n| 4  \t| B                  \t| A              \t| Excluded      \t|            \t|                                    \t|                        \t|                        \t|\n\n::: \n\n<sub> e. Patient 005 was randomized to the treatment B. The surgery was performed on 1-Nov-2004 and was successful according to the surgeon. The patient returned for his first follow-up visit on 1-Feb-2005. The patient did not return to the hospital for any of the next follow-up visits. However one of the study nurses read in the newspaper that the patient (whose name she remembered) had died on 1-Sep-2005 due to a fall when performing repairs to the roof of his house.</sub>\n\n::: callout-note\n\nAccording to an intention-to-treat analysis\n\n| ID \t| Original Treatment \t| Event (death) \t| Start date \t| End date \t| Reason of the end date     \t| Time (start date - end date) \t|\n|----\t|--------------------\t|---------------\t|------------\t|----------\t|----------------------------\t|------------------------------\t|\n| 5  \t| B                  \t| 1             \t| 1-nov-04   \t| 1-sep-05 \t| Died (even it was by fall) \t| 10.13                        \t|\n\n\nAccording to an per-protocol analysis\n\n| ID \t| Treatment original \t| Real treatment \t| Cardiac Event \t| Start date \t| End date (first date of the event) \t| Reason of the end date \t| Time to event (months) \t|\n|----\t|--------------------\t|----------------\t|---------------\t|------------\t|------------------------------------\t|------------------------\t|------------------------\t|\n| 5  \t| B                  \t| B              \t| 0             \t| 1-nov-04   \t| 1-feb-05                           \t| Lost follow up         \t| 3.07                   \t|\n\n\n::: \n\n<sub> f. Patient 006 was randomized to the treatment A. The surgery was performed on 1-Dec-2004 and was successful according to the surgeon. On 1-Mar-2005, the patient came into the hospital with a new MI. The surgeon decided to perform open heart surgery, similar to treatment B. After this surgery, the patient did well and returned regularly to the check-ups. On 1-Jan-2006 was still alive and doing well</sub>\n\n::: callout-note\n\nAccording to an intention-to-treat analysis\n\n| ID \t| Original Treatment \t| Event (death) \t| Start date \t| End date \t| Reason of the end date \t| Time (start date - end date) \t|\n|----\t|--------------------\t|---------------\t|------------\t|----------\t|------------------------\t|------------------------------\t|\n| 6  \t| A                  \t| 0             \t| 1-dic-04   \t| 1-ene-06 \t| End of study           \t| 13.20                        \t|\n\nAccording to an per-protocol analysis\n\n| ID \t| Treatment original \t| Real treatment \t| Cardiac Event \t| Start date \t| End date (first date of the event) \t| Reason of the end date \t| Time to event (months) \t|\n|----\t|--------------------\t|----------------\t|---------------\t|------------\t|------------------------------------\t|------------------------\t|------------------------\t|\n| 6  \t| A                  \t| A              \t| 1             \t| 1-dic-04   \t| 1-mar-05                           \t| New MI                 \t| 3.00                   \t|\n\n::: \n\n\n::: callout-note\n\nSo the final table for intention-to-treat analysis is:\n\n| ID \t| Treatment \t| Time (months) \t| Event \t|\n|----\t|-----------\t|---------------\t|-------\t|\n| 1  \t| A         \t| 18.30         \t| 0     \t|\n| 2  \t| A         \t| 4.63          \t| 1     \t|\n| 3  \t| B         \t| 6.20          \t| 0     \t|\n| 4  \t| B         \t| 0.50          \t| 1     \t|\n| 5  \t| B         \t| 10.13         \t| 1     \t|\n| 6  \t| A         \t| 13.20         \t| 0     \t|\n\n\nAnd the final table for per-protocol analysis is:\n\n| ID \t| Treatment \t| Time (months) \t| Event \t|\n|----\t|-----------\t|---------------\t|-------\t|\n| 1  \t| A         \t| 18.30         \t| 0     \t|\n| 2  \t| A         \t| 4.10          \t| 1     \t|\n| 3  \t| B         \t| 6.20          \t| 0     \t|\n| 4  \t| A         \t| Excluded      \t|       \t|\n| 5  \t| B         \t| 3.07          \t| 0     \t|\n| 6  \t| A         \t| 3.00          \t| 1     \t|\n\n::: \n\n\n##### 3. Patient 003 was lost to follow-up in the trial. Can you think of ways to recover some additional data for this patient?\n\n::: callout-note\n\n - Check with other hospitals\n - Contact with their house or relatives.\n - Check demographics records\n\n::: \n\n##### 4. The data below are from a cervical cancer trial. Enter the data in Excel and analyze the data using R.\n \nGive: \n- Kaplan-Meier plot for the two groups\n- median survival time in each group\n- The proportion of patients alive after 2 years in each group\n- Test the difference between the two curves using the log-rank test\n\n\n4.1 First we import the data from an excel file\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\ndat <- read_excel(\"C:/Users/pined/OneDrive - Universidad Nacional Mayor de San Marcos/Javier 2022/Belgica/AC2/Survival Analysis Exercise Database/Exercises/MPH2021_T2_MAV_SurvAnal_Day_I_Result_Data.xlsx\")\n```\n:::\n\n\n4.2 To start working with survival analysis we have to create an event variable (1 is the event happened (in this case dead))\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat$event <- ifelse(dat$SurvivalStatus == \"dead\", 1, 0)\n```\n:::\n\n\n4.3 We start doing the kaplan meyer plot for the two groups\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nmod2 <- survfit(Surv(SurvivalTime, event) ~ Therapy, data=dat)\nplot(mod2, mark.time=TRUE)\n```\n\n::: {.cell-output-display}\n![](2023-02-13-Survival-Analysis-Session-1_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n4.4. To see the median survival time for each group:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(SurvivalTime, event) ~ Therapy, data = dat)\n\n           n events median 0.95LCL 0.95UCL\nTherapy=A 16     11   1037     291      NA\nTherapy=B 14      5   1307     827      NA\n```\n:::\n:::\n\n::: callout-note\n\nThe median survival time is 1037 for therapy A and 1307 for therapy B.\n\nInterpretation:\n\n      50% of the population was alive at 1037 days in therapy group A\n      \n      50% of the population was alive at 1307 days in therapy group B\n      \n      So group B (new treatment) keeps more alive\n\n::: \n\n4.5. Proportion of patients alive after two years\n\nSeeing the graph:\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(mod2, mark.time=TRUE)\n```\n\n::: {.cell-output-display}\n![](2023-02-13-Survival-Analysis-Session-1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\n\nSeeing the proportion of patients alive after two years (730 days)\n\nAbout 60% in the A group and about 80% in the B group\n\n:::\n\nBut we also see the proportion alive in another way using summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(SurvivalTime, event) ~ Therapy, data = dat)\n\n                Therapy=A \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n   90     16       1    0.938  0.0605       0.8261        1.000\n  142     15       1    0.875  0.0827       0.7271        1.000\n  150     14       1    0.812  0.0976       0.6421        1.000\n  269     13       1    0.750  0.1083       0.5652        0.995\n  291     12       1    0.688  0.1159       0.4941        0.957\n  680     10       1    0.619  0.1230       0.4191        0.914\n  837      9       1    0.550  0.1271       0.3497        0.865\n 1037      7       1    0.471  0.1310       0.2735        0.813\n 1153      4       1    0.354  0.1417       0.1612        0.775\n 1297      3       1    0.236  0.1348       0.0768        0.723\n 1429      2       1    0.118  0.1072       0.0198        0.701\n\n                Therapy=B \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n  272     14       1    0.929  0.0688        0.803            1\n  362     13       1    0.857  0.0935        0.692            1\n  373     12       1    0.786  0.1097        0.598            1\n  827      7       1    0.673  0.1401        0.448            1\n 1307      3       1    0.449  0.2057        0.183            1\n```\n:::\n:::\n\n\n::: callout-note\n\n    In terapy A , at the time 680, 68.8% were alive\n    \n    In terapy B , at the time 827, 78.6% were alive\n\n::: \n\n4.6 Test differences between both curves\n\nLong-rank test\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(SurvivalTime, event) ~ Therapy, data=dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(SurvivalTime, event) ~ Therapy, data = dat)\n\n           N Observed Expected (O-E)^2/E (O-E)^2/V\nTherapy=A 16       11     8.44     0.780      1.68\nTherapy=B 14        5     7.56     0.869      1.68\n\n Chisq= 1.7  on 1 degrees of freedom, p= 0.2 \n```\n:::\n:::\n\n::: callout-note\n\nThe p value is 0.2 so is not a statistical difference between both curves.\n\n::: \n\n4.7 Conclusions\n\n::: callout-note\n\nThe prognosis of patients on the new treatment appeared to be better to reduce mortality cases. The median survival were 1037 days (2.8 years) in therapy group A (standart treatment) and 1307 days (3.5 years of survival) in the therapy group B (new treatment)\n\nThis difference was however not statistical significant (p value = 0.2)\n      \nThis could be because, it was a small study, a new and larger clinical trial should be planned to reach a definitive conclusion. \n\n::: \n\n",
    "supporting": [
      "2023-02-13-Survival-Analysis-Session-1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}